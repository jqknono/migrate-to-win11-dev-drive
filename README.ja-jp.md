# Dev Drive キャッシュ移行スクリプト

その他の言語:
| [English](README.en-us.md) | [简体中文](README.md) | [繁体中文](README.zh-tw.md) | [日本語](README.ja-jp.md) | [한국어](README.ko-kr.md) | [Français](README.fr-fr.md) | [Deutsch](README.de-de.md) | [Italiano](README.it-it.md) | [Español](README.es-es.md) | [Русский](README.ru-ru.md) | [Português (BR)](README.pt-br.md) | [Nederlands](README.nl-nl.md) | [Türkçe](README.tr-tr.md) | [العربية](README.ar-sa.md) | [हिंदी](README.hi-in.md) | [ไทย](README.th-th.md) |

## はじめに

[Dev Drive キャッシュ移行スクリプト](https://github.com/jqknono/migrate-to-win11-dev-drive)は、開発者がさまざまな開発ツールのキャッシュディレクトリを Windows 11 の Dev Drive（ReFS ファイルシステム）に移行し、パフォーマンスを向上させ、ハードディスクの寿命を延ばし、ディスクスペースの使用量を削減するための対話型 PowerShell ツールです。

### 主な利点

- **ハードディスクの寿命延長**: 頻繁に読み書きされるキャッシュファイルを Dev Drive に移動することで、システムディスク（通常は SSD）への書き込み回数を減らし、その使用寿命を延ばすことができます。
- **ディスクスペースの使用量削減**: Node.js の `node_modules` キャッシュや Python の pip キャッシュなどの大きなキャッシュファイルをシステムディスクから移動することで、貴重なシステムディスクのスペースを大幅に解放できます。
- **高性能**: Dev Drive の ReFS ファイルシステムと最適化機能を利用することで、キャッシュの読み書き速度を向上させ、ビルドと開発ツールの応答速度を高速化できます。

### Copy-on-Write (COW) 技術

Dev Drive は ReFS ファイルシステムをベースにしており、Copy-on-Write (COW) 技術を利用しています。COW はリソース管理技術の一種で、その核心的な考え方は、複数の呼び出し元が同時に同じリソースを要求した場合、最初は同じリソースを共有するというものです。特定の呼び出し元がリソースを変更する必要がある場合にのみ、システムはその呼び出し元のためにリソースのコピーを作成し、そのコピーを変更させ、他の呼び出し元が使用する元のリソースには影響を与えません。

Dev Drive のシナリオでは、COW 技術は以下の顕著な利点をもたらします：

1.  **効率的なファイルコピー**: 大きなファイルをコピーする必要がある場合、ReFS はすぐに実際のデータコピーを行わず、同じディスクブロックを指す新しいファイルエントリを作成します。ソースファイルまたはターゲットファイルが変更された場合にのみ、変更されたデータブロックが実際にコピーされます。これにより、ファイルコピー操作が非常に高速になり、追加のディスクスペースをほとんど消費しません（変更が発生するまで）。
2.  **ディスクスペースの節約**: 多くの類似ファイルを含むキャッシュディレクトリ（例えば、複数のプロジェクトが依存する同じバージョンのパッケージ）の場合、COW は変更されていないデータブロックを効果的に共有し、全体のディスク使用量を削減できます。
3.  **パフォーマンスの向上**: 不要なデータコピー操作を削減し、ファイル操作の効率を向上させます。

### Dev Drive と ReFS の特性

Windows 11 は Dev Drive を導入しました。これは開発者向けに最適化されたストレージボリュームです。Dev Drive は Resilient File System (ReFS) をファイルシステムとして使用し、専用の最適化機能を有効にしています。

**ReFS (Resilient File System)** はマイクロソフトが開発した次世代ファイルシステムで、従来の NTFS と比較して以下の利点があります：

- **データの完全性**: チェックサムと自動修復機能により、データの信頼性を向上させます。
- **スケーラビリティ**: より大きなボリュームとファイルサイズをサポートします。
- **パフォーマンスの最適化**: 仮想化とビッグデータのワークロード向けに最適化されています。
- **COW の統合**: Copy-on-Write セマンティクスをネイティブでサポートしており、これは開発シナリオにおけるファイル操作に特に有利です。

**Dev Drive の最適化**: ReFS をベースに、Dev Drive はさらに開発者のワークロード向けに最適化されており、例えばパッケージマネージャーのキャッシュ、ビルド出力などのシナリオにおけるパフォーマンス向上が図られています。

## スクリプトの機能

このスクリプトは、以下の主要機能を提供します：

- **キャッシュの移行**: さまざまな開発ツールのキャッシュディレクトリを Dev Drive に移行することをサポートします。
  - Node.js (npm, yarn, pnpm)
  - Python (pip)
  - .NET (NuGet)
  - Java (Maven, Gradle)
  - Go (Go modules)
  - Rust (Cargo)
  - VS Code 拡張機能
  - Windows TEMP/TMP ディレクトリ
    - JetBrains IDE (IntelliJ, PyCharm など)
  - Android SDK
  - Chocolatey (Windows パッケージマネージャー)
  - ユーザーの非表示フォルダ (.xxx)
- **Dev Drive の作成**: ユーザーが新しい Dev Drive パーティションを作成するのを支援する対話型ウィザードを提供します。
- **Dev Drive の削除**: Dev Drive パーティションを安全に削除し、移行されたキャッシュを元の場所に復元するオプションを提供します。
- **キャッシュの復元**: Dev Drive に移行されたキャッシュディレクトリを元の場所に復元します。
- **リンクによる移行**: シンボリックリンク/ジャンクションポイントを作成してキャッシュディレクトリを移行し、環境変数を変更しません。
- **テストモード**: 実際にシステムを変更することなく、Dev Drive の削除などの機能をテストするための安全なシミュレーション操作を提供します。

## 使用方法

1.  **システム要件**:
    - Windows 11 (ビルド 22000 以降)
    - PowerShell 7+ (pwsh)
2.  **スクリプトの実行**:
    - 管理者として PowerShell 7 (pwsh) を開きます。
    - スクリプトがあるディレクトリに移動します。
    - `.\Setup-DevDriveCache.ps1` を実行します。
3.  **対話型操作**:
    - スクリプトを起動すると、対話型メニューが表示され、さまざまな操作を案内します。
    - キャッシュの移行、Dev Drive の作成や削除などを行うには、対応するオプションを選択します。
    - すべての重要な操作にはユーザーの確認が必要で、安全性を確保します。

## 注意事項

- **目的**: このスクリプトの目的は、キャッシュフォルダをクリーンアップすることではなく、移行することです。移行後、元のキャッシュデータは依然として存在し、保存場所が変更されただけです。
- **バックアップ**: 重要な操作（Dev Drive の削除など）を行う前に、重要なデータのバックアップを推奨します。
- **環境変数**: スクリプトはユーザー環境変数を読み取ったり書き込んだりしません。移行はシンボリックリンクを介して行われます。

## 参考資料

- [Microsoft Dev Drive 公式ドキュメント](https://learn.microsoft.com/en-us/windows/dev-drive/)
- [Resilient File System (ReFS) 公式ドキュメント](https://learn.microsoft.com/en-us/windows-server/storage/refs/refs-overview)

## サポート

- [宁屏去广告](https://www.nullprivate.com)