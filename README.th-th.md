# สคริปต์การย้ายแคช Dev Drive

ภาษาอื่นๆ:
| [English](README.en-us.md) | [简体中文](README.zh-cn.md) | [繁体中文](README.zh-tw.md) | [日本語](README.ja-jp.md) | [한국어](README.ko-kr.md) | [Français](README.fr-fr.md) | [Deutsch](README.de-de.md) | [Italiano](README.it-it.md) | [Español](README.es-es.md) | [Русский](README.ru-ru.md) | [Português (BR)](README.pt-br.md) | [Nederlands](README.nl-nl.md) | [Türkçe](README.tr-tr.md) | [العربية](README.ar-sa.md) | [हिंदी](README.hi-in.md) | [ไทย](README.th-th.md) |

## บทนำ

[สคริปต์การย้ายแคช Dev Drive](https://github.com/jqknono/migrate-to-win11-dev-drive) เป็นเครื่องมือ PowerShell แบบโต้ตอบที่ออกแบบมาเพื่อช่วยนักพัฒนาในการย้ายไดเรกทอรีแคชของเครื่องมือการพัฒนาต่างๆ ไปยัง Dev Drive ของ Windows 11 (ระบบไฟล์ ReFS) เพื่อเพิ่มประสิทธิภาพ ขยายอายุการใช้งานของฮาร์ดดิสก์ และลดการใช้พื้นที่ดิสก์

### ข้อดีหลัก

- **ขยายอายุการใช้งานฮาร์ดดิสก์**: โดยการย้ายไฟล์แคชที่มีการอ่านและเขียนบ่อยไปยัง Dev Drive สามารถลดจำนวนครั้งในการเขียนลงบนดิสก์ระบบ (โดยทั่วไปคือ SSD) ซึ่งจะช่วยขยายอายุการใช้งาน
- **ลดการใช้พื้นที่ดิสก์**: การย้ายไฟล์แคชขนาดใหญ่ (เช่น แคช `node_modules` ของ Node.js, แคช pip ของ Python เป็นต้น) ออกจากดิสก์ระบบ สามารถปลดปล่อยพื้นที่ดิสก์ระบบที่มีค่าได้อย่างมีนัยสำคัญ
- **ประสิทธิภาพสูง**: การใช้ประโยชน์จากระบบไฟล์ ReFS และคุณสมบัติการเพิ่มประสิทธิภาพของ Dev Drive สามารถเพิ่มความเร็วในการอ่านและเขียนแคช ทำให้การสร้างและการตอบสนองของเครื่องมือการพัฒนาเร็วขึ้น

### เทคโนโลยี Copy-on-Write (COW)

Dev Drive ใช้ระบบไฟล์ ReFS ซึ่งใช้ประโยชน์จากเทคโนโลยี Copy-on-Write (COW) COW เป็นเทคนิคการจัดการทรัพยากรที่แนวคิดหลักคือ: เมื่อผู้เรียกหลายคนร้องขอทรัพยากรเดียวกันพร้อมกัน พวกเขาจะแชร์ทรัพยากรชุดเดียวกันในตอนแรก เฉพาะเมื่อผู้เรียกรายใดรายหนึ่งต้องการแก้ไขทรัพยากรเท่านั้น ระบบจะสร้างสำเนาของทรัพยากรสำหรับผู้เรียกรายนั้น จากนั้นจึงให้แก้ไขสำเนานั้น โดยไม่ส่งผลกระทบต่อทรัพยากรต้นฉบับที่ผู้เรียกรายอื่นๆ ใช้งานอยู่

ในสถานการณ์ของ Dev Drive เทคโนโลยี COW นำมาซึ่งข้อดีที่สำคัญ:

1.  **การคัดลอกไฟล์ที่มีประสิทธิภาพ**: เมื่อต้องการคัดลอกไฟล์ขนาดใหญ่ ReFS จะไม่ทำการคัดลอกข้อมูลจริงทันที แต่จะสร้างรายการไฟล์ใหม่ที่ชี้ไปยังบล็อกดิสก์เดียวกัน เฉพาะเมื่อไฟล์ต้นฉบับหรือไฟล์เป้าหมายถูกแก้ไขเท่านั้น จึงจะคัดลอกบล็อกข้อมูลที่ถูกแก้ไขจริงๆ 这使得文件复制操作变得非常快速，并且几乎不占用额外的磁盘空间（直到发生修改）
2.  **ประหยัดพื้นที่ดิสก์**: สำหรับไดเรกทอรีแคชที่มีไฟล์ที่คล้ายกันจำนวนมาก (例如，多个项目依赖的相同版本的包) COW สามารถแชร์บล็อกข้อมูลที่ไม่ถูกแก้ไขได้อย่างมีประสิทธิภาพ ซึ่งจะลดการใช้พื้นที่ดิสก์โดยรวม
3.  **เพิ่มประสิทธิภาพ**: ลดการดำเนินการคัดลอกข้อมูลที่ไม่จำเป็น ซึ่งเพิ่มประสิทธิภาพของการดำเนินการไฟล์

### Dev Drive กับคุณสมบัติของ ReFS

Windows 11 ได้แนะนำ Dev Drive ซึ่งเป็นโวลุมการจัดเก็บข้อมูลที่ได้รับการเพิ่มประสิทธิภาพโดยเฉพาะสำหรับนักพัฒนา Dev Drive ใช้ Resilient File System (ReFS) เป็นระบบไฟล์ และเปิดใช้งานฟังก์ชันการเพิ่มประสิทธิภาพเฉพาะ

**ReFS (Resilient File System)** เป็นระบบไฟล์รุ่นใหม่ที่พัฒนาโดยไมโครซอฟท์ เมื่อเทียบกับ NTFS แบบดั้งเดิม มีข้อดีดังนี้:

- **ความสมบูรณ์ของข้อมูล**: เพิ่มความน่าเชื่อถือของข้อมูลผ่านฟังก์ชันการตรวจสอบและซ่อมแซมอัตโนมัติ
- **ความสามารถในการขยาย**: รองรับโวลุมและขนาดไฟล์ที่ใหญ่ขึ้น
- **การเพิ่มประสิทธิภาพ**: ได้รับการเพิ่มประสิทธิภาพสำหรับงานเสมือนจริงและข้อมูลขนาดใหญ่
- **การบูรณาการ COW**: รองรับความหมายของ Copy-on-Write โดยกำเนิด ซึ่งเป็นประโยชน์อย่างยิ่งสำหรับการดำเนินการไฟล์ในสถานการณ์การพัฒนา

**การเพิ่มประสิทธิภาพของ Dev Drive**: บนพื้นฐานของ ReFS Dev Drive ได้รับการเพิ่มประสิทธิภาพเพิ่มเติมสำหรับงานของนักพัฒนา เช่น การเพิ่มประสิทธิภาพสำหรับสถานการณ์เช่น แคชของตัวจัดการแพ็กเกจ เอาต์พุตการสร้าง เป็นต้น

## ฟังก์ชันของสคริปต์

สคริปต์นี้มีฟังก์ชันหลักดังนี้:

- **ย้ายแคช**: รองรับการย้ายไดเรกทอรีแคชของเครื่องมือการพัฒนาหลายชนิดไปยัง Dev Drive
  - Node.js (npm, yarn, pnpm)
  - Python (pip)
  - .NET (NuGet)
  - Java (Maven, Gradle)
  - Go (Go modules)
  - Rust (Cargo)
  - ส่วนขยาย VS Code
  - ไดเรกทอรี TEMP/TMP ของ Windows
    - JetBrains IDE (IntelliJ, PyCharm ฯลฯ)
  - Android SDK
  - Chocolatey (ตัวจัดการแพ็กเกจของ Windows)
  - โฟลเดอร์ที่ซ่อนของผู้ใช้ (.xxx)
- **สร้าง Dev Drive**: มีตัวช่วยแบบโต้ตอบเพื่อช่วยผู้ใช้สร้างพาร์ติชัน Dev Drive ใหม่
- **ลบ Dev Drive**: ถอดพาร์ติชัน Dev Drive ออกอย่างปลอดภัย และมีตัวเลือกในการคืนค่าแคชที่ย้ายไปแล้วกลับไปยังตำแหน่งเดิม
- **คืนค่าแคช**: คืนค่าไดเรกทอรีแคชที่ย้ายไปยัง Dev Drive กลับไปยังตำแหน่งเดิม
- **การย้ายลิงก์**: ย้ายไดเรกทอรีแคชผ่านการสร้าง symbolic link/junction point โดยไม่แก้ไขตัวแปรสภาพแวดล้อมใดๆ
- **โหมดทดสอบ**: มีการจำลองการดำเนินการที่ปลอดภัยสำหรับทดสอบฟังก์ชันเช่น การลบ Dev Drive โดยไม่แก้ไขระบบจริง

## วิธีการใช้งาน

1.  **ข้อกำหนดของระบบ**:
    - Windows 11 (Build 22000 หรือสูงกว่า)
    - PowerShell 7+ (pwsh)
2.  **การเรียกใช้สคริปต์**:
    - เปิด PowerShell 7 (pwsh) ในฐานะผู้ดูแลระบบ
    - นำทางไปยังไดเรกทอรีที่มีสคริปต์อยู่
    - ดำเนินการ `.\Setup-DevDriveCache.ps1`
3.  **การดำเนินการแบบโต้ตอบ**:
    - เมื่อสคริปต์เริ่มทำงาน จะแสดงเมนูแบบโต้ตอบเพื่อแนะนำคุณผ่านการดำเนินการต่างๆ
    - เลือกตัวเลือกที่เกี่ยวข้องเพื่อย้ายแคช สร้างหรือลบ Dev Drive เป็นต้น
    - การดำเนินการที่สำคัญทั้งหมดต้องการการยืนยันจากผู้ใช้เพื่อให้แน่ใจว่าปลอดภัย

## ข้อควรทราบ

- **วัตถุประสงค์**: วัตถุประสงค์ของสคริปต์นี้คือการย้ายโฟลเดอร์แคช ไม่ใช่การล้างข้อมูลเหล่านั้น หลังจากการย้าย ข้อมูลแคชต้นฉบับยังคงมีอยู่ เพียงแต่ตำแหน่งการจัดเก็บเปลี่ยนไปเท่านั้น
- **สำรองข้อมูล**: ก่อนดำเนินการสำคัญ (เช่น การลบ Dev Drive) ขอแนะนำให้สำรองข้อมูลสำคัญ
- **ตัวแปรสภาพแวดล้อม**: สคริปต์จะไม่อ่านหรือเขียนตัวแปรสภาพแวดล้อมของผู้ใช้ การย้ายจะเสร็จสิ้นผ่าน symbolic link

## แหล่งข้อมูลอ้างอิง

- [เอกสารอย่างเป็นทางการของ Microsoft Dev Drive](https://learn.microsoft.com/en-us/windows/dev-drive/)
- [เอกสารอย่างเป็นทางการของ Resilient File System (ReFS)](https://learn.microsoft.com/en-us/windows-server/storage/refs/refs-overview)

## การสนับสนุน

- [宁屏去广告](https://www.nullprivate.com)