# Скрипт миграции кэша Dev Drive

Другие языки:
| [English](README.en-us.md) | [简体中文](README.md) | [繁体中文](README.zh-tw.md) | [日本語](README.ja-jp.md) | [한국어](README.ko-kr.md) | [Français](README.fr-fr.md) | [Deutsch](README.de-de.md) | [Italiano](README.it-it.md) | [Español](README.es-es.md) | [Русский](README.ru-ru.md) | [Português (BR)](README.pt-br.md) | [Nederlands](README.nl-nl.md) | [Türkçe](README.tr-tr.md) | [العربية](README.ar-sa.md) | [हिंदी](README.hi-in.md) | [ไทย](README.th-th.md) |

## Введение

[Скрипт миграции кэша Dev Drive](https://github.com/jqknono/migrate-to-win11-dev-drive) — это интерактивный инструмент PowerShell, разработанный для помощи разработчикам в переносе каталогов кэша различных инструментов разработки на Dev Drive (файловая система ReFS) в Windows 11, чтобы повысить производительность, продлить срок службы диска и уменьшить занимаемое дисковое пространство.

### Основные преимущества

- **Увеличение срока службы диска**: Перемещая часто читаемые и записываемые файлы кэша на Dev Drive, можно уменьшить количество операций записи на системный диск (обычно SSD), тем самым продлевая его срок службы.
- **Снижение использования дискового пространства**: Перенос больших файлов кэша (таких как кэш `node_modules` Node.js, кэш pip Python и т.д.) с системного диска позволяет значительно высвободить ценное пространство на системном диске.
- **Высокая производительность**: Использование файловой системы ReFS и оптимизационных возможностей Dev Drive позволяет повысить скорость чтения и записи кэша, ускоряя сборку и время отклика инструментов разработки.

### Технология Copy-on-Write (COW)

Dev Drive основан на файловой системе ReFS и использует технологию Copy-on-Write (COW). COW — это технология управления ресурсами, основная идея которой заключается в следующем: когда несколько вызывающих сторон одновременно запрашивают один и тот же ресурс, они изначально используют одну и ту же копию ресурса. Только когда одной из вызывающих сторон необходимо изменить ресурс, система создает копию ресурса для этой вызывающей стороны, а затем позволяет ей изменять эту копию, не затрагивая исходный ресурс, используемый другими вызывающими сторонами.

В сценарии с Dev Drive технология COW предоставляет значительные преимущества:

1.  **Эффективное копирование файлов**: При необходимости скопировать большой файл ReFS немедленно не выполняет фактическое копирование данных, а создает новую запись файла, указывающую на те же блоки диска. Только когда исходный или целевой файл изменяется, действительно копируются измененные блоки данных. Это делает операцию копирования файлов очень быстрой и почти не занимающей дополнительного дискового пространства (до момента внесения изменений).
2.  **Экономия дискового пространства**: Для каталогов кэша, содержащих множество похожих файлов (например, пакеты одинаковой версии, от которых зависят несколько проектов), COW может эффективно совместно использовать неизмененные блоки данных, тем самым уменьшая общее использование диска.
3.  **Повышение производительности**: Уменьшение ненужных операций копирования данных повышает эффективность файловых операций.

### Dev Drive и характеристики ReFS

Windows 11 представил Dev Drive — том хранения, специально оптимизированный для разработчиков. Dev Drive использует Resilient File System (ReFS) в качестве своей файловой системы и включает специальные функции оптимизации.

**ReFS (Resilient File System)** — это файловая система нового поколения, разработанная Microsoft, которая по сравнению с традиционной NTFS имеет следующие преимущества:

- **Целостность данных**: Повышение надежности данных с помощью контрольных сумм и функций автоматического восстановления.
- **Масштабируемость**: Поддержка больших томов и размеров файлов.
- **Оптимизация производительности**: Оптимизирована для виртуализации и рабочих нагрузок с большими данными.
- **Интеграция COW**: Нативная поддержка семантики Copy-on-Write, что особенно полезно для файловых операций в сценариях разработки.

**Оптимизация Dev Drive**: На основе ReFS, Dev Drive дополнительно оптимизирован для рабочих нагрузок разработчиков, например, повышение производительности для сценариев с кэшем менеджеров пакетов, выводом сборки и т.д.

## Функции скрипта

Данный скрипт предоставляет следующие основные функции:

- **Миграция кэша**: Поддержка переноса каталогов кэша различных инструментов разработки на Dev Drive.
  - Node.js (npm, yarn, pnpm)
  - Python (pip)
  - .NET (NuGet)
  - Java (Maven, Gradle)
  - Go (Go modules)
  - Rust (Cargo)
  - Расширения VS Code
  - Каталоги TEMP/TMP Windows
    - JetBrains IDE (IntelliJ, PyCharm и т.д.)
  - Android SDK
  - Chocolatey (менеджер пакетов Windows)
  - Скрытые папки пользователя (.xxx)
- **Создание Dev Drive**: Предоставление интерактивного мастера для помощи пользователям в создании нового раздела Dev Drive.
- **Удаление Dev Drive**: Безопасное удаление раздела Dev Drive с опцией восстановления перенесенного кэша в исходное расположение.
- **Восстановление кэша**: Восстановление каталогов кэша, перенесенных на Dev Drive, в их исходное расположение.
- **Миграция через ссылки**: Перенос каталогов кэша путем создания символических ссылок/точек соединения без изменения каких-либо переменных среды.
- **Тестовый режим**: Предоставление безопасного режима симуляции для тестирования таких функций, как удаление Dev Drive, без фактического изменения системы.

## Инструкции по использованию

1.  **Системные требования**:
    - Windows 11 (сборка 22000 или выше)
    - PowerShell 7+ (pwsh)
2.  **Запуск скрипта**:
    - Откройте PowerShell 7 (pwsh) от имени администратора.
    - Перейдите в каталог, где находится скрипт.
    - Выполните `.\Setup-DevDriveCache.ps1`.
3.  **Интерактивная работа**:
    - После запуска скрипта отобразится интерактивное меню, которое проведет вас через различные операции.
    - Выберите соответствующий параметр для миграции кэша, создания или удаления Dev Drive и т.д.
    - Все критические операции требуют подтверждения пользователя для обеспечения безопасности.

## Важные замечания

- **Цель**: Цель этого скрипта — перенос папок кэша, а не их очистка. После миграции исходные данные кэша по-прежнему существуют, только изменилось место их хранения.
- **Резервное копирование**: Перед выполнением важных операций (таких как удаление Dev Drive) рекомендуется создавать резервные копии важных данных.
- **Переменные среды**: Скрипт не читает и не записывает переменные среды пользователя; миграция выполняется через символические ссылки.

## Ссылочные материалы

- [Официальная документация Microsoft по Dev Drive](https://learn.microsoft.com/en-us/windows/dev-drive/)
- [Официальная документация по Resilient File System (ReFS)](https://learn.microsoft.com/en-us/windows-server/storage/refs/refs-overview)

## Поддержка

- [Nullprivate (блокировка рекламы)](https://www.nullprivate.com)